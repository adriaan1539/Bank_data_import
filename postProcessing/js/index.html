
<!DOCTYPE html>
<html>
 <head>
    <title>Post-processing</title>
    <script src="https://code.jquery.com/jquery-3.2.1.min.js" integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin="anonymous"></script>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
    <script type="text/javascript" src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/d3/4.11.0/d3.min.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/d3-dsv/1.0.7/d3-dsv.min.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/d3-time/1.0.7/d3-time.min.js"></script>
    <style>
        .bar { fill: steelblue;  }
        html {
            height: 100%;
        }
        body {
            min-height: 100%;
            background-color: #CCC;
        }
        .container { 
            background-color: #FFF; 
            max-width: 1200px;
            min-height: 100%;
            padding: 25px 0 25px 0;
        }

        .graph_options {
            padding: 5px 25px 5px 25px;
        }
        .graph_options .row + .row {
            margin-top: 25px;

        }
        .graph_options label {
            min-width: 85px;
        }
    </style>
 </head>
 <body>
     <div class="container">
         <div class="graph_options">
             <form class="form-inline">
                <div class="row">
                    <div class="col-md-4 form-group">
                        <label for="category">Categorie</label>
                        <select class="form-control" id="category">
                        </select>
                    </div>
                    <div class="col-md-4 form-group">
                        <label for="start_date">Startdatum</label>
                            <input type="date" class="form-control" id="start_date">
                    </div>
                    <div class="col-md-4 form-group">
                        <label for="end_date">Einddatum</label>
                        <input type="date" class="form-control" id="end_date">
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-4 form-group">
                        <label for="interval">Interval</label>
                        <select class="form-control" id="interval">
                            <option value="year">Jaar</option>>
                            <option value="quarter">Kwartaal</option>
                            <option value="month">Maand</option>
                            <option value="week">Week</option>
                        </select>
                    </div>
                    <div class="col-md-4">
                        <button type="button" class="btn btn-default" id="go_button">Go Go Go!</button>
                    </div>
                </div>
            </form>
        </div>
        <div><svg id="svg"></svg></div>
    </div>
    <script type="text/javascript">
        var data = {
            categories: [],
            entries: []
        };
        var formatDate = d3.timeFormat("%d-%b-%y");
        d3.queue()
        .defer(d3.csv, "/output/categories.csv")
        .defer(d3.csv, "/output/bankAccountEntries.csv")
        .await(analyze);
      
        function analyze(error, categories, bankAccountEntries) {
            if(error) { console.log(error); }
        
            data.categories = categories;
            data.entries = bankAccountEntries;

            addCategoriesToForm(categories);
        }

        function addCategoriesToForm(categories) {
            var category_input = document.getElementById('category');
            for(var category of categories) {
                var option = document.createElement('option');
                option.value = category['Name'];
                option.text = category['Name'];
                category_input.add(option, null);
            }
        }

        // set the dimensions and margins of the graph
        var margin = {top: 20, right: 20, bottom: 30, left: 40},
        width = 960 - margin.left - margin.right,
        height = 500 - margin.top - margin.bottom;

        // set the ranges
        var x = d3.scaleBand()
            .range([0, width])
            .padding(0.1);
        var y = d3.scaleLinear()
            .range([height, 0]);
            
        // append the svg object to the body of the page
        // append a 'group' element to 'svg'
        // moves the 'group' element to the top left margin
        var svg = d3.select("#svg")
            .attr("width", width + margin.left + margin.right)
            .attr("height", height + margin.top + margin.bottom)
            .append("g")
            .attr("transform", 
                "translate(" + margin.left + "," + margin.top + ")");

        function draw() {
            // format the data
            data.entries.forEach(function(d) {
                d.date = formatDate(new Date(d.year, d.month, d.day));
                d.total = Math.abs(d.total);
            });


            // Scale the range of the data in the domains
            x.domain(data.entries.map(function(d) { return d.category; }));
            y.domain([0, d3.max(data.entries, function(d) { return Math.abs(d.amount); })]);

            // append the rectangles for the bar chart
            svg.selectAll(".bar")
                .data(data.entries)
                    .enter().append("rect")
                        .attr("class", "bar")
                        .attr("x", function(d) { return x(d.category); })
                        .attr("width", x.bandwidth())
                        .attr("y", function(d) { return y(Math.abs(d.amount)); })
                        .attr("height", function(d) { return height - y(Math.abs(d.amount)); });

            // add the x Axis
            svg.append("g")
            .attr("transform", "translate(0," + height + ")")
            .call(d3.axisBottom(x));

            // add the y Axis
            svg.append("g")
            .call(d3.axisLeft(y));
        }

        $('#go_button').on('click', draw);
</script>
</body>
</html>
